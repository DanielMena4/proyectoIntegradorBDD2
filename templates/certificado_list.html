{% extends 'base.html' %}
{% block title %}Certificados{% endblock %}

{% block content %}
<div class="d-flex justify-content-between mb-3">
  <h4>Certificados</h4>
  <a class="btn btn-outline-primary" href="{{ url_for('nuevo_certificado') }}">
    <i class="bi bi-plus-circle"></i> Nuevo
  </a>
</div>

<table class="table table-hover align-middle">
  <thead class="table-light">
    <tr>
      <th>ID</th>
      <th>Catequizando</th>
      <th>Nivel</th>
      <th>Parroquia</th>
      <th>Fecha Emisión</th>
      <th>Firmado Por</th>
      <th>Archivo</th>
      <th class="text-end">Acciones</th>
    </tr>
  </thead>

  <tbody>
    {% for c in certificados %}
    <tr>
      <!-- ID -->
      <td>{{ c.certificadoId }}</td>

      <!-- Catequizando -->
      <td>
        {% if c.catequizando %}
          {{ c.catequizando.nombreCatequizando }}
          {{ c.catequizando.apellidoCatequizando }}
        {% else %}
          <span class="text-muted">—</span>
        {% endif %}
      </td>

      <!-- Nivel -->
      <td>
        {% if c.nivel %}
          {{ c.nivel.nombreNivel }}
        {% else %}
          <span class="text-muted">—</span>
        {% endif %}
      </td>

      <!-- Parroquia -->
      <td>
        {% if c.parroquia %}
          {{ c.parroquia.nombreParro }}
        {% else %}
          <span class="text-muted">—</span>
        {% endif %}
      </td>

      <!-- Fecha -->
      <td>{{ c.fechaEmision or '—' }}</td>

      <!-- Firmado -->
      <td>{{ c.firmadoPor or '—' }}</td>

      <!-- Archivo -->
      <td>
        {% if c.archivo %}
          <a href="{{ c.archivo }}" target="_blank" class="btn btn-sm btn-outline-primary">
            <i class="bi bi-file-earmark"></i>
          </a>
        {% else %}
          <span class="text-muted">—</span>
        {% endif %}
      </td>

      <!-- Acciones -->
      <td class="text-end">
        <a class="btn btn-sm btn-outline-secondary"
           href="{{ url_for('editar_certificado', id=c._id) }}">
          <i class="bi bi-pencil"></i>
        </a>

        <form method="post"
              action="{{ url_for('borrar_certificado', id=c._id) }}"
              style="display:inline"
              onsubmit="return confirm('¿Eliminar este certificado?')">
          <button class="btn btn-sm btn-outline-danger">
            <i class="bi bi-trash"></i>
          </button>
        </form>
      </td>
    </tr>

    {% else %}
    <tr>
      <td colspan="8" class="text-center text-muted py-4">
        No hay certificados registrados
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
